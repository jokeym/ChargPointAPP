# 充电桩交互指令

## 指令格式
开头 | 类型 | 数据 | 校验和 |结束
:-------:| :-------: | :-------: | :-------:| :-------:
$CHARGE | type | {....,value} | *checksum  |\<CR>\<LF>
>**checksum:**  数据校验方式；在$和*之间异或取字符U1 hex

>#### C语言添加和检查校验和实例源码：
```c
/**在指令结尾添加校验和*/
static void AddChecksum(char *p)
{
    char *q = NULL;
    unsigned char sum = 0;
    for (q = p + 1, sum = 0; *q; q++)
        sum ^= *q;
    sprintf(p + strlen(p), "*%02X\r\n", sum);
}
/**检查指令结尾校验和*/
static int Checksum(char *buff, int len)
{
    unsigned char sum = 0;
    unsigned char cs = 0;
    int i = 0;
    char *p = strchr((char *)buff, '*');
    if (p == NULL)
        return 0;
    for (i = 1; buff[i] != '*'; i++)
        sum ^= buff[i];
    cs = strtol(p + 1, (char **)NULL, 16);
    return cs == sum;
}
```
>**例子:**    $CHARGE,GETCTRL*69

## 指令
>指令不区分大小写

### 获取控制信息
>例子：$CHARGE,GETCTRL*69

位号 | 数据 | 单位 | 说明
:---:|:----:|:----:|:---:
0 |$CHARGE|-|数据头
1|GETCTRL|-|数据类型

### 返回控制信息
>例子：$CHARGE,CTRLINFO,2,9,7,56,1544435812,1,2*2C

位号 | 数据 | 单位 | 说明
:---:|:----:|:----:|:---:
0 |$CHARGE|-|数据头
1|CTRLINFO|-|数据类型
2|2|数值|最小功率
3|9|数值|最大功率
4|7|数值|当前实际功率
5|56|数值|充值卡里的剩余次数
6|1544435812|数值|现在控制器的RTC时间戳
7|1|数值|1:开启夜间重启<br>0:关闭夜间重启
8|2|数值|重启时间（0~24）


### 设置控制参数
>例子：$CHARGE,SETCTRL,3,6,1544434005,1,3*54

位号 | 数据 | 单位 | 说明
:---:|:----:|:----:|:---:
0 |$CHARGE|-|数据头
1|SETCTRL|-|数据类型
2|3|数值|设置最小功率
3|6|数值|设置最大功率
4|1544434005|数值|设置RTC时间戳
5|1|数值|1:开启夜间重启<br>0:关闭夜间重启
5|3|数值|重启时间（0~24）
